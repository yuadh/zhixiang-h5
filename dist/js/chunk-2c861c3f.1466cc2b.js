(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2c861c3f"],{"0837":function(t,e,o){},"083a":function(t,e,o){"use strict";var s=o("0d51"),i=TypeError;t.exports=function(t,e){if(!delete t[e])throw i("Cannot delete property "+s(e)+" of "+s(t))}},"088e":function(t,e,o){"use strict";o("f238")},"1be8":function(t,e,o){"use strict";o("9900")},"1df5":function(t,e,o){},"230c":function(t,e,o){"use strict";o.r(e);var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"article-container"},[e("van-nav-bar",{staticClass:"page-nav-bar",attrs:{"left-arrow":"",title:"知享园"},on:{"click-left":function(e){return t.$router.back()}}}),e("div",{staticClass:"main-wrap"},[t.loading?e("div",{staticClass:"loading-wrap"},[e("van-loading",{attrs:{color:"#3296fa",vertical:""}},[t._v("加载中")])],1):t.article.title?e("div",{staticClass:"article-detail"},[e("h1",{staticClass:"article-title"},[t._v(t._s(t.article.title))]),e("van-cell",{staticClass:"user-info",attrs:{center:"",border:!1}},[e("van-image",{staticClass:"avatar",attrs:{slot:"icon",round:"",fit:"cover",src:t.article.aut_photo},slot:"icon"}),e("div",{staticClass:"user-name",attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.userInfo.intro||"知享园用户"))]),e("div",{staticClass:"publish-date",attrs:{slot:"label"},slot:"label"},[t._v(t._s(t._f("relativeTime")(t.article.pubdate)))]),e("follow-user",{staticClass:"follow-btn",attrs:{"user-id":t.article.aut_id},model:{value:t.article.is_followed,callback:function(e){t.$set(t.article,"is_followed",e)},expression:"article.is_followed"}})],1),e("div",{ref:"article-content",staticClass:"article-content markdown-body",domProps:{innerHTML:t._s(t.article.content)}}),e("van-divider",[t._v("正文结束")]),e("comment-list",{attrs:{source:t.article.art_id,list:t.commentList},on:{"onload-success":function(e){t.totalCommentCount=e.total_count},"reply-click":t.onReplyClick}}),e("div",{staticClass:"article-bottom"},[e("van-button",{staticClass:"comment-btn",attrs:{type:"default",round:"",size:"small"},on:{click:function(e){t.isPostShow=!0}}},[t._v("输入评论..")]),e("van-icon",{staticClass:"comment-icon",attrs:{name:"comment-o",info:t.totalCommentCount},on:{click:function(e){t.isPostShow=!0}}}),e("like-article",{staticClass:"btn-item",attrs:{"article-id":t.article.art_id},model:{value:t.article.attitude,callback:function(e){t.$set(t.article,"attitude",e)},expression:"article.attitude"}}),e("collect-article",{staticClass:"btn-item",attrs:{"article-id":t.article.art_id},model:{value:t.article.is_collected,callback:function(e){t.$set(t.article,"is_collected",e)},expression:"article.is_collected"}}),e("van-icon",{attrs:{name:"share",color:"#777777"}})],1),e("van-popup",{style:{height:"94%"},attrs:{position:"bottom",closeable:"","close-icon-position":"top-right"},model:{value:t.isPostShow,callback:function(e){t.isPostShow=e},expression:"isPostShow"}},[e("comment-post",{attrs:{target:t.article.art_id},on:{"post-success":t.onPostSuccess}})],1)],1):404===t.errStatus?e("div",{staticClass:"error-wrap"},[e("van-icon",{attrs:{name:"failure"}}),e("p",{staticClass:"text"},[t._v("该资源不存在或已删除！")])],1):e("div",{staticClass:"error-wrap"},[e("van-icon",{attrs:{name:"failure"}}),e("p",{staticClass:"text"},[t._v("内容加载失败！")]),e("van-button",{staticClass:"retry-btn",on:{click:t.loadArticle}},[t._v("点击重试")])],1)]),e("van-popup",{staticStyle:{height:"100%"},attrs:{position:"bottom"},model:{value:t.isReplyShow,callback:function(e){t.isReplyShow=e},expression:"isReplyShow"}},[t.isReplyShow?e("comment-reply",{attrs:{comment:t.currentComment},on:{close:function(e){t.isReplyShow=!1}}}):t._e()],1)],1)},i=[],a=(o("4662"),o("28a2")),n=(o("14d9"),o("3c65"),o("2423")),c=function(){var t=this,e=t._self._c;return t.isFollowed?e("van-button",{staticClass:"follow-btn",attrs:{round:"",size:"small",loading:t.loading},on:{click:t.onFollow}},[t._v("已关注")]):e("van-button",{staticClass:"follow-btn",attrs:{type:"info",color:"#3296fa",round:"",size:"small",icon:"plus",loading:t.loading},on:{click:t.onFollow}},[t._v("关注")])},l=[],r=o("c24f"),u={name:"FollowUser",components:{},model:{prop:"isFollowed",event:"update-is_followed"},props:{isFollowed:{type:Boolean,required:!0},userId:{type:[Number,String,Object],required:!0}},data(){return{loading:!1}},computed:{},watch:{},created(){},mounted(){},methods:{async onFollow(){this.loading=!0;try{this.isFollowed?await Object(r["b"])(this.userId):await Object(r["a"])(this.userId),this.$emit("update-is_followed",!this.isFollowed)}catch(t){console.log(t);let e="操作失败，请重试！";t.response&&400===t.response.status&&(e="你不能关注你自己！"),this.$toast(e)}this.loading=!1}}},d=u,m=o("2877"),h=Object(m["a"])(d,c,l,!1,null,"3e61ddc4",null),p=h.exports,f=function(){var t=this,e=t._self._c;return e("van-button",{class:{collected:t.value},attrs:{icon:t.value?"star":"star-o",loading:t.loading},on:{click:t.onCollect}})},v=[],b={name:"CollectArticle",components:{},props:{value:{type:Boolean,required:!0},articleId:{type:[Number,String,Object],required:!0}},data(){return{loading:!1}},computed:{},watch:{},created(){},mounted(){},methods:{async onCollect(){this.loading=!0;try{this.value?await Object(n["c"])(this.articleId):await Object(n["a"])(this.articleId),this.$emit("input",!this.value),this.$toast.success(this.value?"取消收藏":"收藏成功")}catch(t){this.$toast.fail("操作失败，请重试！")}this.loading=!1}}},g=b,_=(o("6fd5"),Object(m["a"])(g,f,v,!1,null,"d2033be8",null)),w=_.exports,C=function(){var t=this,e=t._self._c;return e("van-button",{class:{liked:1===t.value},attrs:{icon:1===t.value?"good-job":"good-job-o",loading:t.loading},on:{click:t.onCollect}})},y=[],k={name:"LikeArticle",components:{},props:{value:{type:Number,required:!0},articleId:{type:[Number,String,Object],required:!0}},data(){return{loading:!1}},computed:{},watch:{},created(){},mounted(){},methods:{async onCollect(){this.loading=!0;try{let t=-1;1===this.value?await Object(n["d"])(this.articleId):(await Object(n["b"])(this.articleId),t=1),this.$emit("input",t),this.$toast.success(1===t?"点赞成功":"取消点赞")}catch(t){console.log(t),this.$toast.fail("操作失败，请重试！")}this.loading=!1}}},j=k,O=(o("088e"),Object(m["a"])(j,C,y,!1,null,"b3ee9654",null)),S=O.exports,P=function(){var t=this,e=t._self._c;return e("van-list",{attrs:{finished:t.finished,"finished-text":"已显示全部评论",error:t.error,"error-text":"加载失败，请点击重试","immediate-check":!1},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(o,s){return e("comment-item",{key:s,attrs:{comment:o},on:{"reply-click":function(e){return t.$emit("reply-click",e)}}})})),1)},I=[],L=o("0c6d");const T=t=>Object(L["a"])({method:"GET",url:"/v1_0/comments",params:t}),x=t=>Object(L["a"])({method:"POST",url:"/v1_0/comment/likings",data:{target:t}}),E=t=>Object(L["a"])({method:"DELETE",url:"/v1_0/comment/likings/"+t}),$=t=>Object(L["a"])({method:"POST",url:"/v1_0/comments",data:t});var A=function(){var t=this,e=t._self._c;return e("van-cell",{staticClass:"comment-item"},[e("van-image",{staticClass:"avatar",attrs:{slot:"icon",round:"",fit:"cover",src:t.comment.aut_photo},slot:"icon"}),e("div",{staticClass:"title-wrap",attrs:{slot:"title"},slot:"title"},[e("div",{staticClass:"user-name"},[t._v(t._s(t.userInfo.intro||"知享园用户"))]),e("van-button",{staticClass:"like-btn",class:{liked:t.comment.is_liking},attrs:{icon:t.comment.is_liking?"good-job":"good-job-o",loading:t.commentLoading},on:{click:t.onCommentLike}},[t._v(t._s(t.comment.like_count||"赞"))])],1),e("div",{attrs:{slot:"label"},slot:"label"},[e("p",{staticClass:"comment-content"},[t._v(t._s(t.comment.content))]),e("div",{staticClass:"bottom-info"},[e("span",{staticClass:"comment-pubdate"},[t._v(t._s(t._f("relativeTime")(t.comment.pubdate)))]),e("van-button",{staticClass:"reply-btn",attrs:{round:""},on:{click:function(e){return t.$emit("reply-click",t.comment)}}},[t._v("回复 "+t._s(t.comment.reply_count))])],1)])],1)},q=[],R=o("2f62"),F={name:"CommentItem",components:{},props:{comment:{type:Object,required:!0}},data(){return{commentLoading:!1}},computed:{...Object(R["b"])(["userInfo"])},watch:{},created(){},mounted(){},methods:{async onCommentLike(){this.commentLoading=!0;try{this.comment.is_liking?(await E(this.comment.com_id),this.comment.like_count--):(await x(this.comment.com_id),this.comment.like_count++),this.comment.is_liking=!this.comment.is_liking}catch(t){this.$toast("操作失败，请重试")}this.commentLoading=!1}}},N=F,G=(o("1be8"),Object(m["a"])(N,A,q,!1,null,"61690c52",null)),z=G.exports,D={name:"CommentList",components:{CommentItem:z},props:{source:{type:[Number,String,Object],required:!0},list:{type:Array,default:()=>[]},type:{type:String,validator(t){return["a","c"].includes(t)},default:"a"}},data(){return{loading:!1,finished:!1,offset:null,limit:10,error:!1}},computed:{},watch:{},created(){this.loading=!0,this.onLoad()},mounted(){},methods:{async onLoad(){try{const{data:t}=await T({type:this.type,source:this.source.toString(),offset:this.offset,limit:this.limit}),{results:e}=t.data;this.list.push(...e),this.$emit("onload-success",t.data),this.loading=!1,e.length?this.offset=t.data.last_id:this.finished=!0}catch(t){this.error=!0,this.loading=!1}}}},H=D,B=Object(m["a"])(H,P,I,!1,null,"825e9c54",null),J=B.exports,U=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-post"},[e("van-field",{staticClass:"post-field",attrs:{rows:"2",autosize:"",type:"textarea",maxlength:"50",placeholder:"请输入评论","show-word-limit":""},model:{value:t.message,callback:function(e){t.message="string"===typeof e?e.trim():e},expression:"message"}}),e("van-button",{staticClass:"post-btn",attrs:{disabled:!t.message.length},on:{click:t.onPost}},[t._v("发布")])],1)},M=[],K={name:"CommentPost",components:{},inject:{articleId:{type:[Number,String,Object],default:null}},props:{target:{type:[Number,String,Object],required:!0}},data(){return{message:""}},computed:{},watch:{},created(){},mounted(){},methods:{async onPost(){this.$toast.loading({message:"发布中...",forbidClick:!0,duration:0});try{const{data:t}=await $({target:this.target.toString(),content:this.message,art_id:this.articleId?this.articleId.toString():this.articleId});this.message="",this.$emit("post-success",t.data),this.$toast.success("发布成功")}catch(t){this.$toast.fail("发布失败")}}}},Q=K,V=(o("73a2"),Object(m["a"])(Q,U,M,!1,null,"66896603",null)),W=V.exports,X=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-reply"},[e("van-nav-bar",{attrs:{title:t.comment.reply_count>0?t.comment.reply_count+"条回复":"暂无回复"}},[e("van-icon",{attrs:{slot:"left",name:"cross"},on:{click:function(e){return t.$emit("close")}},slot:"left"})],1),e("div",{staticClass:"scroll-wrap"},[e("comment-item",{attrs:{comment:t.comment}}),e("van-cell",{attrs:{title:"全部回复"}}),e("comment-list",{attrs:{list:t.commentList,source:t.comment.com_id,type:"c"}})],1),e("div",{staticClass:"reply-bottom"},[e("van-button",{staticClass:"write-btn",attrs:{size:"small",round:""},on:{click:function(e){t.isPostShow=!0}}},[t._v("写评论")])],1),e("van-popup",{style:{height:"95%"},attrs:{closeable:"","close-icon-position":"top-right",position:"bottom"},model:{value:t.isPostShow,callback:function(e){t.isPostShow=e},expression:"isPostShow"}},[e("comment-post",{attrs:{target:t.comment.com_id},on:{"post-success":t.onPostSuccess}})],1)],1)},Y=[],Z={name:"CommentReply",components:{CommentItem:z,CommentList:J,CommentPost:W},props:{comment:{type:Object,required:!0}},data(){return{isPostShow:!1,commentList:[]}},computed:{},watch:{},created(){},mounted(){},methods:{onPostSuccess(t){this.comment.reply_count++,this.isPostShow=!1,this.commentList.unshift(t.new_obj)}}},tt=Z,et=(o("dc10"),Object(m["a"])(tt,X,Y,!1,null,"fc7ee0b6",null)),ot=et.exports,st={name:"ArticleIndex",components:{FollowUser:p,CollectArticle:w,LikeArticle:S,CommentList:J,CommentPost:W,CommentReply:ot},provide:function(){return{articleId:this.articleId}},props:{articleId:{type:[Number,String,Object],required:!0}},data(){return{article:{},loading:!0,errStatus:0,followLoading:!1,totalCommentCount:0,isPostShow:!1,commentList:[],isReplyShow:!1,currentComment:{}}},computed:{...Object(R["b"])(["userInfo"])},watch:{},created(){this.loadArticle()},mounted(){},methods:{async loadArticle(){this.loading=!0;try{const{data:t}=await Object(n["e"])(this.articleId);this.article=t.data,setTimeout(()=>{this.previewImage()},0)}catch(t){t.response&&404===t.response.status&&(this.errStatus=404)}this.loading=!1},previewImage(){const t=this.$refs["article-content"],e=t.querySelectorAll("img"),o=[];e.forEach((t,e)=>{o.push(t.src),t.onclick=()=>{Object(a["a"])({images:o,startPosition:e})}})},onPostSuccess(t){this.isPostShow=!1,this.commentList.unshift(t.new_obj),this.totalCommentCount=this.totalCommentCount+1},onReplyClick(t){this.currentComment=t,this.isReplyShow=!0}}},it=st,at=(o("3ca3"),Object(m["a"])(it,s,i,!1,null,"498a5d93",null));e["default"]=at.exports},2423:function(t,e,o){"use strict";o.d(e,"f",(function(){return i})),o.d(e,"e",(function(){return a})),o.d(e,"a",(function(){return n})),o.d(e,"c",(function(){return c})),o.d(e,"b",(function(){return l})),o.d(e,"d",(function(){return r}));var s=o("0c6d");const i=t=>Object(s["a"])({method:"GET",url:"/v1_0/articles",params:t}),a=t=>Object(s["a"])({method:"GET",url:"/v1_0/articles/"+t}),n=t=>Object(s["a"])({method:"POST",url:"/v1_0/article/collections",data:{target:t}}),c=t=>Object(s["a"])({method:"DELETE",url:"/v1_0/article/collections/"+t}),l=t=>Object(s["a"])({method:"POST",url:"/v1_0/article/likings",data:{target:t}}),r=t=>Object(s["a"])({method:"DELETE",url:"/v1_0/article/likings/"+t})},"3c65":function(t,e,o){"use strict";var s=o("23e7"),i=o("7b0b"),a=o("07fa"),n=o("3a34"),c=o("083a"),l=o("3511"),r=1!==[].unshift(0),u=function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(t){return t instanceof TypeError}},d=r||!u();s({target:"Array",proto:!0,arity:1,forced:d},{unshift:function(t){var e=i(this),o=a(e),s=arguments.length;if(s){l(o+s);var r=o;while(r--){var u=r+s;r in e?e[u]=e[r]:c(e,u)}for(var d=0;d<s;d++)e[d]=arguments[d]}return n(e,o+s)}})},"3ca3":function(t,e,o){"use strict";o("1df5")},"41d3":function(t,e,o){},"6fd5":function(t,e,o){"use strict";o("0837")},"73a2":function(t,e,o){"use strict";o("c0ae")},9900:function(t,e,o){},c0ae:function(t,e,o){},c24f:function(t,e,o){"use strict";o.d(e,"f",(function(){return i})),o.d(e,"g",(function(){return a})),o.d(e,"d",(function(){return n})),o.d(e,"c",(function(){return c})),o.d(e,"a",(function(){return l})),o.d(e,"b",(function(){return r})),o.d(e,"e",(function(){return u})),o.d(e,"i",(function(){return d})),o.d(e,"h",(function(){return m}));var s=o("0c6d");const i=t=>Object(s["a"])({method:"POST",url:"/v1_0/authorizations",data:t}),a=t=>Object(s["a"])({method:"GET",url:"/v1_0/sms/codes/"+t}),n=()=>Object(s["a"])({method:"GET",url:"/v1_0/user"}),c=()=>Object(s["a"])({method:"GET",url:"/v1_0/user/channels"}),l=t=>Object(s["a"])({method:"POST",url:"/v1_0/user/followings",data:{target:t}}),r=t=>Object(s["a"])({method:"DELETE",url:"/v1_0/user/followings/"+t}),u=t=>Object(s["a"])({method:"GET",url:"/v1_0/user/profile"}),d=t=>Object(s["a"])({method:"PATCH",url:"/v1_0/user/profile",data:t}),m=t=>Object(s["a"])({method:"PATCH",url:"/v1_0/user/photo",data:t})},dc10:function(t,e,o){"use strict";o("41d3")},f238:function(t,e,o){}}]);
//# sourceMappingURL=chunk-2c861c3f.1466cc2b.js.map