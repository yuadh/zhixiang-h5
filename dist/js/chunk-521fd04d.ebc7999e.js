(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-521fd04d"],{"083a":function(t,e,a){"use strict";var s=a("0d51"),n=TypeError;t.exports=function(t,e){if(!delete t[e])throw n("Cannot delete property "+s(e)+" of "+s(t))}},"090e":function(t,e,a){"use strict";a("0e6a")},"0cfc":function(t,e,a){"use strict";a("ea88")},"0e6a":function(t,e,a){},"13bd":function(t,e,a){},"165a":function(t,e,a){},2423:function(t,e,a){"use strict";a.d(e,"f",(function(){return n})),a.d(e,"e",(function(){return i})),a.d(e,"a",(function(){return r})),a.d(e,"c",(function(){return c})),a.d(e,"b",(function(){return l})),a.d(e,"d",(function(){return o}));var s=a("0c6d");const n=t=>Object(s["a"])({method:"GET",url:"/v1_0/articles",params:t}),i=t=>Object(s["a"])({method:"GET",url:"/v1_0/articles/"+t}),r=t=>Object(s["a"])({method:"POST",url:"/v1_0/article/collections",data:{target:t}}),c=t=>Object(s["a"])({method:"DELETE",url:"/v1_0/article/collections/"+t}),l=t=>Object(s["a"])({method:"POST",url:"/v1_0/article/likings",data:{target:t}}),o=t=>Object(s["a"])({method:"DELETE",url:"/v1_0/article/likings/"+t})},"3c65":function(t,e,a){"use strict";var s=a("23e7"),n=a("7b0b"),i=a("07fa"),r=a("3a34"),c=a("083a"),l=a("3511"),o=1!==[].unshift(0),d=function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(t){return t instanceof TypeError}},u=o||!d();s({target:"Array",proto:!0,arity:1,forced:u},{unshift:function(t){var e=n(this),a=i(e),s=arguments.length;if(s){l(a+s);var o=a;while(o--){var d=o+s;o in e?e[d]=e[o]:c(e,d)}for(var u=0;u<s;u++)e[u]=arguments[u]}return r(e,a+s)}})},"446d":function(t,e,a){"use strict";a("13bd")},"7abe":function(t,e,a){"use strict";a.r(e);a("14d9");var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home-container"},[e("van-nav-bar",{staticClass:"page-nav-bar",attrs:{title:"首页"}}),e("van-tabs",{staticClass:"channel-tabs",attrs:{swipeable:""},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[t._l(t.channels,(function(t){return e("van-tab",{key:t.id,attrs:{title:t.name}},[e("article-list",{ref:"article-list",refInFor:!0,attrs:{channel:t}})],1)})),e("div",{staticClass:"placeholder",attrs:{slot:"nav-right"},slot:"nav-right"}),e("div",{staticClass:"hamburger-btn",attrs:{slot:"nav-right"},slot:"nav-right"},[e("i",{staticClass:"doc doc-sousuo",on:{click:function(e){return t.$router.push("/search")}}}),e("i",{staticClass:"doc doc-gengduo",on:{click:function(e){t.isChennelEditShow=!0}}})])],2),e("van-popup",{style:{height:"100%"},attrs:{closeable:"","close-icon-position":"top-left",position:"bottom"},model:{value:t.isChennelEditShow,callback:function(e){t.isChennelEditShow=e},expression:"isChennelEditShow"}},[e("channel-edit",{attrs:{"my-channels":t.channels,active:t.active},on:{"update-active":t.onUpdateActive}})],1)],1)},n=[],i=a("c24f"),r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"article-list"},[e("van-pull-refresh",{attrs:{"success-text":t.refreshSuccessText,"success-duration":1500},on:{refresh:t.onRefresh},model:{value:t.isreFreshLoading,callback:function(e){t.isreFreshLoading=e},expression:"isreFreshLoading"}},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",error:t.error,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.error=e},load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(t,a){return e("article-item",{key:a,staticClass:"article-item",attrs:{article:t}})})),1)],1)],1)},c=[],l=(a("3c65"),a("2423")),o=function(){var t=this,e=t._self._c;return e("van-cell",{staticClass:"article-item",attrs:{to:{name:"article",params:{articleId:t.article.art_id}}}},[e("div",{staticClass:"title van-multi-ellipsis--l2",attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.article.title))]),e("div",{attrs:{slot:"label"},slot:"label"},[3===t.article.cover.type?e("div",{staticClass:"cover-wrap"},t._l(t.article.cover.images,(function(t,a){return e("div",{key:a,staticClass:"cover-item"},[e("van-image",{staticClass:"cover-item-img",attrs:{fit:"cover",src:t}})],1)})),0):t._e(),e("div",{staticClass:"label-info-wrap"},[e("span",[t._v(t._s(t.userInfo.intro||"知享园用户"))]),e("span",[t._v(t._s(t.article.comm_count)+"评论")]),e("span",[t._v(t._s(t._f("relativeTime")(t.article.pubdate)))])])]),1===t.article.cover.type?e("van-image",{staticClass:"right-cover",attrs:{slot:"default",fit:"cover",src:t.article.cover.images[0]},slot:"default"}):t._e()],1)},d=[],u=a("2f62"),h={name:"ArticleItem",components:{},props:{article:{type:Object,required:!0}},data(){return{}},computed:{...Object(u["b"])(["userInfo"])},watch:{},created(){},mounted(){},methods:{}},f=h,v=(a("090e"),a("2877")),m=Object(v["a"])(f,o,d,!1,null,"88a6e880",null),p=m.exports,b={name:"ArticleList",components:{ArticleItem:p},props:{channel:{type:Object,required:!0}},data(){return{list:[],loading:!1,finished:!1,timestamp:null,error:!1,isreFreshLoading:!1,refreshSuccessText:"刷新成功"}},computed:{},watch:{},created(){},mounted(){},methods:{async onLoad(){try{const{data:t}=await Object(l["f"])({channel_id:this.channel.id,timestamp:this.timestamp||Date.now(),with_top:1}),{results:e}=t.data;this.list.push(...e),this.loading=!1,e.length?this.timestamp=t.data.pre_timestamp:this.finished=!0}catch(t){this.error=!0,this.loading=!1}},async onRefresh(){try{const{data:t}=await Object(l["f"])({channel_id:this.channel.id,timestamp:Date.now(),with_top:1}),{results:e}=t.data;this.list.unshift(...e),this.isreFreshLoading=!1,this.refreshSuccessText=`刷新成功，更新了${e.length}条数据`}catch(t){this.refreshSuccessText="刷新失败",this.isreFreshLoading=!1}}}},C=b,_=(a("7c99"),Object(v["a"])(C,r,c,!1,null,"e344570a",null)),g=_.exports,y=function(){var t=this,e=t._self._c;return e("div",{staticClass:"channel-edit"},[e("van-cell",{attrs:{border:!1}},[e("div",{staticClass:"title-text",attrs:{slot:"title"},slot:"title"},[t._v("我的板块 "),e("span",[t._v("点击进入板块")])]),e("van-button",{staticClass:"edit-btn",attrs:{type:"danger",plain:"",round:"",size:"mini"},on:{click:function(e){t.isEdit=!t.isEdit}}},[t._v(t._s(t.isEdit?"完成":"编辑"))])],1),e("van-grid",{staticClass:"my-grid",attrs:{gutter:10}},t._l(t.myChannels,(function(a,s){return e("van-grid-item",{key:s,staticClass:"grid-item",on:{click:function(e){return t.onMyChannelClick(a,s)}}},[e("van-icon",{directives:[{name:"show",rawName:"v-show",value:t.isEdit&&!t.fiexdChannels.includes(a.id),expression:"isEdit && !fiexdChannels.includes(channel.id)"}],attrs:{slot:"icon",name:"clear"},slot:"icon"}),e("span",{staticClass:"text",class:{active:s===t.active},attrs:{slot:"text"},slot:"text"},[t._v(t._s(a.name))])],1)})),1),e("van-cell",{attrs:{border:!1}},[e("div",{staticClass:"title-text",attrs:{slot:"title"},slot:"title"},[t._v("更多板块"),e("span",[t._v("点击添加板块")])])]),e("van-grid",{staticClass:"recommend-grid",attrs:{gutter:10}},t._l(t.recommendChannels,(function(a,s){return e("van-grid-item",{key:s,staticClass:"grid-item",on:{click:function(e){return t.onAddChannel(a)}}},[e("van-icon",{attrs:{slot:"icon",name:"add"},slot:"icon"}),e("span",{staticClass:"text",attrs:{slot:"text"},slot:"text"},[t._v(t._s(a.name))])],1)})),1)],1)},O=[],w=a("0c6d");const E=()=>Object(w["a"])({method:"GET",url:"/v1_0/channels"}),j=t=>Object(w["a"])({method:"PATCH",url:"/v1_0/user/channels",data:{channels:[t]}}),x=t=>Object(w["a"])({method:"DELETE",url:"/v1_0/user/channels/"+t});var T=a("5f87"),k=a("c9d9"),A={name:"ChannelEdit",components:{},props:{myChannels:{type:Array,required:!0},active:{type:Number,required:!0}},data(){return{allChannels:[],isEdit:!1,fiexdChannels:[0]}},computed:{...Object(u["b"])(["user"]),recommendChannels(){return this.allChannels.filter(t=>!this.myChannels.find(e=>e.id===t.id))}},watch:{},created(){this.loadAllChannels()},mounted(){},methods:{async loadAllChannels(){try{const{data:t}=await E();this.allChannels=t.data.channels}catch(t){this.$toast("数据获取失败")}},async onAddChannel(t){if(this.myChannels.push(t),this.user)try{await j({id:t.id,seq:this.myChannels.length})}catch(e){this.$toast("保存失败，请稍后重试")}else Object(T["b"])(k["b"],this.myChannels)},onMyChannelClick(t,e){if(this.isEdit){if(this.fiexdChannels.includes(t.id))return;this.myChannels.splice(e,1),e<=this.active&&this.$emit("update-active",this.active-1,!0),this.deleteChannel(t)}else this.$emit("update-active",e,!1)},async deleteChannel(t){try{this.user?await x(t.id):Object(T["b"])(k["b"],this.myChannels)}catch(e){this.$toast("操作失败，请稍后重试")}}}},L=A,S=(a("0cfc"),Object(v["a"])(L,y,O,!1,null,"462c6688",null)),P=S.exports,$={name:"HomeIndex",components:{ArticleList:g,ChannelEdit:P},props:{},data(){return{active:0,channels:[],isChennelEditShow:!1}},computed:{...Object(u["b"])(["user"])},watch:{},created(){this.loadChannels()},mounted(){},methods:{async loadChannels(){try{let t=[];if(this.user){const{data:e}=await Object(i["c"])();t=e.data.channels}else{const e=Object(T["a"])(k["b"]);if(e)t=e;else{const{data:e}=await Object(i["c"])();t=e.data.channels}}this.channels=t}catch(t){this.$toast("获取频道数据失败")}},onUpdateActive(t,e=!0){this.active=t,this.isChennelEditShow=e}}},F=$,G=(a("446d"),Object(v["a"])(F,s,n,!1,null,"9600dc1e",null));e["default"]=G.exports},"7c99":function(t,e,a){"use strict";a("165a")},c24f:function(t,e,a){"use strict";a.d(e,"f",(function(){return n})),a.d(e,"g",(function(){return i})),a.d(e,"d",(function(){return r})),a.d(e,"c",(function(){return c})),a.d(e,"a",(function(){return l})),a.d(e,"b",(function(){return o})),a.d(e,"e",(function(){return d})),a.d(e,"i",(function(){return u})),a.d(e,"h",(function(){return h}));var s=a("0c6d");const n=t=>Object(s["a"])({method:"POST",url:"/v1_0/authorizations",data:t}),i=t=>Object(s["a"])({method:"GET",url:"/v1_0/sms/codes/"+t}),r=()=>Object(s["a"])({method:"GET",url:"/v1_0/user"}),c=()=>Object(s["a"])({method:"GET",url:"/v1_0/user/channels"}),l=t=>Object(s["a"])({method:"POST",url:"/v1_0/user/followings",data:{target:t}}),o=t=>Object(s["a"])({method:"DELETE",url:"/v1_0/user/followings/"+t}),d=t=>Object(s["a"])({method:"GET",url:"/v1_0/user/profile"}),u=t=>Object(s["a"])({method:"PATCH",url:"/v1_0/user/profile",data:t}),h=t=>Object(s["a"])({method:"PATCH",url:"/v1_0/user/photo",data:t})},ea88:function(t,e,a){}}]);
//# sourceMappingURL=chunk-521fd04d.ebc7999e.js.map